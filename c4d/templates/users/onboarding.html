{% extends 'layouts/box.html' %}
{% load static %}

{% block content %}

{% if onboarding %}
<h2 class="mb-4">Onboarding</h2>
{% else %}
<h2 class="mb-4">Edit your Profile</h2>
{% endif %}

<div class="text-center flex flex-col items-center">

    <!-- {% if user.profile.avatar %}
      <img id="avatar" class="w-36 h-36 rounded-full object-cover my-4"
           src="{{ user.profile.avatar.url }}"
           alt="Avatar" />
    {% else %}
      <img id="avatar" class="w-36 h-36 rounded-full object-cover my-4"
           src="{% static 'images/default-avatar.png' %}"
           alt="Avatar" />
    {% endif %} -->

      <p>Note: You have to complete the Onboarding in order to see the Job postings.</p>

    <div class="text-center max-w-md">
        <h3 id="displayname">{{ user.profile.displayname|default:"" }}</h3>
        <div class="text-gray-400 mb-2 -mt-3">Your email: <strong>{{ user.email }}</strong></div>
    </div>
</div>

<form method="POST" enctype="multipart/form-data" class="space-y-4">
    {% csrf_token %}
    {% if onboarding %}
      {# Render basic fields only, excluding "skill_sets" and "skill_level" #}
      <br>
      <div>
        {{ form.first_name.errors }}
        <label for="id_first_name" class="block font-semibold">First Name</label>
        {{ form.first_name }}
      </div>
      <br>
      <div>
        {{ form.middle_name.errors }}
        <label for="id_middle_name" class="block font-semibold">Middle Name</label>
        {{ form.middle_name }}
      </div>
      <div>
        <br>
        {{ form.last_name.errors }}
        <label for="id_last_name" class="block font-semibold">Last Name</label>
        {{ form.last_name }}
        <br>
      </div>
      <div>
        <br>
        {{ form.date_of_birth.errors }}
        <label for="id_date_of_birth" class="block font-semibold">Date of Birth</label>
        {{ form.date_of_birth }}
        <br>
      </div>
      <div>
        <br>
        {{ form.state.errors }}
        <label for="id_state" class="block font-semibold">State</label>
        {{ form.state }}
        <br>
      </div>
      <div>
        <br>
        {{ form.suburb.errors }}
        <label for="id_suburb" class="block font-semibold">Suburb</label>
        {{ form.suburb }}
        <br>
      </div>
      <div>
        <br>
        {{ form.clearance_level.errors }}
        <label for="id_clearance_level" class="block font-semibold">Clearance Level</label>
        {{ form.clearance_level }}
        <br>
      </div>
      <div>
        <br>
        {{ form.clearance_no.errors }}
        <label for="id_clearance_no" class="block font-semibold">CSID Number</label>
        {{ form.clearance_no }}
        <br>
      </div>
      <div>
        <br>
        {{ form.clearance_expiry.errors }}
        <label for="id_clearance_expiry" class="block font-semibold">Expiry Date</label>
        {{ form.clearance_expiry }}
        <br>
      </div>
    {% else %}
      {{ form.as_p }}
    {% endif %}
    <br>
    <button type="submit" class="bg-blue-500 text-white py-2 px-4 rounded">Submit</button>

    {% if onboarding %}
      <a class="bg-gray-500 text-white py-2 px-4 rounded ml-1" href="{% url 'home' %}">Skip for now</a>
    {% else %}
      <a class="bg-gray-500 text-white py-2 px-4 rounded ml-1" href="{{ request.META.HTTP_REFERER }}">Cancel</a>
    {% endif %}
</form>

<script>
    // This updates the email
    const displayNameInput = document.getElementById('id_displayname');
    const displayNameOutput = document.getElementById('displayname');
    if (displayNameInput && displayNameOutput) {
      displayNameInput.addEventListener('input', (event) => {
          displayNameOutput.innerText = event.target.value;
      });
    }
</script>

{% endblock %}
